server             = true
datacenter         = "dc1"
primary_datacenter = "dc1"
node_name          = "{{ NODE_NAME }}"

acl {
  enabled                  = true
  default_policy           = "deny"
  enable_token_persistence = true
  tokens {
    initial_management = "{{ CONSUL_INITIAL_MANAGEMENT_TOKEN }}"
    agent = "{{ CONSUL_INITIAL_MANAGEMENT_TOKEN }}"
  }
}

ports {
  http  = 8500
  https = 8501
  grpc  = 8502
}

encrypt                 = "{{ CONSUL_GOSSIP_ENCRYPTION_KEY }}"
encrypt_verify_incoming = true
encrypt_verify_outgoing = true


tls {
  defaults {
    ca_file         = "/etc/consul.d/consul-agent-ca.pem"
    cert_file       = "/etc/consul.d/dc1-server-consul-0.pem"
    key_file        = "/etc/consul.d/dc1-server-consul-0-key.pem"
    verify_incoming = false
    verify_outgoing = true
  }

  internal_rpc {
    verify_incoming        = true
    verify_server_hostname = false
  }
}

auto_encrypt {
  allow_tls = true
}

data_dir         = "{{ CONSUL_DATA_PATH }}"
bind_addr        = "0.0.0.0"
client_addr      = "0.0.0.0"
advertise_addr   = "{{ ADVERTISE_ADDR }}"
bootstrap_expect = {{ BOOTSTRAP_EXPECT }}

retry_join = ["{{ RETRY_JOIN }}"]

ui_config {
  enabled = true
}

log_level     = "INFO"
enable_syslog = true

connect {
  enabled = true
  enable_mesh_gateway_wan_federation = true
}

node_meta = {
  zone = "{{ ZONE }}"
}

autopilot {
  redundancy_zone_tag = "zone"
}
